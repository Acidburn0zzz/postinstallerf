#!/bin/bash
#
# +--------------------------------------------------------------------------------+
# | Copyright (C) 2014 Kuboosoft                                                   |
# |                                                                                |
# |This program is free software; You can distribute it and / or                   |
# |modify it under the terms of the GNU General Public License                     |
# |as published by the Free Software Foundation; any                               |
# |version 3 of the License, or (optionally) any version                           |
# |later. http://www.gnu.org/licenses/gpl-3.0.html                                 |
# |This program is distributed in the hope that it will be useful,                 |
# |but WITHOUT ANY WARRANTY. See the GNU General Public License                    |
# |for details.                                                                    |
# +--------------------------------------------------------------------------------+
# |This code is designed, written and maintained by David Vasquez    		   |
# |Any questions, comments or advice on this code                                  |
# |should be addressed to:                                                         |
# |https://plus.google.com/communities/118230919321773121406                       |
# +--------------------------------------------------------------------------------+
# FEDORA  20 y 21 CONFPOST 1.5.0 


# +--------------------------------------------------------------------------------------------------+
# |AQUI INICIA EL MENU                                                                               |
# +--------------------------------------------------------------------------------------------------+

source /usr/bin/postinstallerf/pid

cleanlist() {
if [ "$(id -u)" -eq 0 ]; then
rm -f /tmp/confpost..lck
else
cat /dev/null > /tmp/confpost..lck
fi
}


if [ "$(id -u)" -eq 0 ]; then
echo 'root'
else
echo 'no root'
cleanlist
exit
fi

    generateInstallMenu(){ 
            im="yad --image="/usr/share/icons/acciones/conf.png" --image-on-top --class="Configure-Tuning" --window-icon="/usr/share/icons/acciones/conf.png" --list --radiolist  --width=800 --height=600 --title \"PostInstallerF for Fedora 64bit (Ver 1.2.0)\" --text \"Select items from the list below\" "
            im=$im"--column=\"\" --column \"Application\" --column \"Description\"    --column \"Status\"  		     "

 # Building Install Menue

            # Building Install Menue


if [ $(echo $LANG | cut -b1-2) = "es" ]; then


if ! $installed | grep "Activar sudo" > /dev/null; then

SER=$(grep "$user ALL=(ALL) ALL" /etc/sudoers) > /dev/null
	if [[ "$?" != 0 ]]; then

                    im=$im"FALSE \"Activar sudo\"    \"Permite a un administrador del sistema delegar autoridad a ciertos usuarios la capacidad de ejecutar comandos como root u otro usuario\" \"[$user] NO AGREGADO  \"  "
else
                    im=$im"FALSE \"Activar sudo\"    \"Permite a un administrador del sistema delegar autoridad a ciertos usuarios la capacidad de ejecutar comandos como root u otro usuario\" \"[$user] AGREGADO  \"  "
fi
            fi


if ! $installed | grep "Periodo de gracia sudo" > /dev/null; then

if [ $(cat /etc/sudoers | grep -c 'Defaults:ALL timestamp_timeout=0') -gt 0 ] ; then
im=$im"FALSE \"Periodo de gracia sudo\"    \"Credenciales para permitir/no permitir al usuario ejecutar sudo de nuevo por un período de tiempo sin necesidad de autenticación.\" \"NO VULNERABLE  \"  "
else
im=$im"FALSE \"Periodo de gracia sudo\"    \"Credenciales para permitir/no permitir al usuario ejecutar sudo de nuevo por un período de tiempo sin necesidad de autenticación.\" \"VULNERABLE  \"  "
fi
 fi


if ! $installed | grep "Eliminar Kernels Antiguos" > /dev/null; then

if [ -f /usr/bin/yum ]; then

                    im=$im"FALSE \"Eliminar Kernels Antiguos\"    \"Limpia kernels obsoletos\" \"ACTIVO  \"  "
else
                    im=$im"FALSE \"Eliminar Kernels Antiguos\"    \"Limpia kernels obsoletos\" \"NO ACTIVO  \"  "
fi
            fi



if ! $installed | grep "Completar Instalaciones pendientes" > /dev/null; then

if [ -f /usr/bin/yum ]; then

                    im=$im"FALSE \"Completar Instalaciones pendientes\"    \"Continua instalaciones no completadas por errores del sistema\" \"ACTIVO  \"  "
else
im=$im"FALSE \"Completar Instalaciones pendientes\"    \"Continua instalaciones no completadas por errores del sistema\" \"NO ACTIVO  \"  "
fi

            fi


if ! $installed | grep "Informacion del Sistema" > /dev/null; then
                    im=$im"FALSE \"Informacion del Sistema\"    \"Muestra la informacion del sistema\" \"ACTIVO  \"  "

            fi


if ! $installed | grep "Cinnamon" > /dev/null; then
if [ -x /usr/share/doc/cinnamon* ]; then
                    im=$im"FALSE \"Cinnamon\"    \"Shell para Gnome 3, Diseño tradicional, funciones avanzadas y fáciles de usar, potente y flexible\" \"INSTALADO  \"  "
else
im=$im"FALSE \"Cinnamon\"    \"Shell para Gnome 3, Diseño tradicional, funciones avanzadas y fáciles de usar, potente y flexible\" \"NO INSTALADO  \"  "
fi

            fi

if ! $installed | grep "Plasma-wallpaper-dreamdesktop" > /dev/null; then
if [ -f /usr/lib/kde4/dreamdesktop.so ]; then
                    im=$im"FALSE \"Plasma-wallpaper-dreamdesktop\"    \"Un innovador fondo de escritorio animado para KDE.\" \"INSTALADO  \"  "
else
im=$im"FALSE \"Plasma-wallpaper-dreamdesktop\"    \"Un innovador fondo de escritorio animado para KDE.\" \"NO INSTALADO  \"  "
fi

            fi


if ! $installed | grep "Entorno de escritorio GNOME/SHELL" > /dev/null; then
if [ "`ps -e | grep gdm`" ]; then
                    im=$im"FALSE \"Entorno de escritorio GNOME/SHELL\"    \"GNOME es un entorno de escritorio e infraestructura de desarrollo para GNU/Linux; compuesto enteramente de software libre.\" \"INSTALADO  \"  "
else
im=$im"FALSE \"Entorno de escritorio GNOME/SHELL\"    \"GNOME es un entorno de escritorio e infraestructura de desarrollo para GNU/Linux; compuesto enteramente de software libre.\" \"NO INSTALADO  \"  "
fi
            fi


if ! $installed | grep "Entorno de escritorio KDE" > /dev/null; then
if [ -x /usr/share/doc/kdesdk* ]; then
                    im=$im"FALSE \"Entorno de escritorio KDE\"    \"KDE es un proyecto de software libre para la creación de un entorno de escritorio\" \"INSTALADO  \"  "
else
im=$im"FALSE \"Entorno de escritorio KDE\"    \"KDE es un proyecto de software libre para la creación de un entorno de escritorio\" \"NO INSTALADO  \"  "
fi
            fi


if ! $installed | grep "Entorno de escritorio XFCE" > /dev/null; then
if [ -x /usr/share/doc/xfce?-panel ]; then
                    im=$im"FALSE \"Entorno de escritorio XFCE\"    \"Xfce es un entorno de escritorio ligero para sistemas tipo UNIX\" \"INSTALADO  \"  "
else
im=$im"FALSE \"Entorno de escritorio XFCE\"    \"Xfce es un entorno de escritorio ligero para sistemas tipo UNIX\" \"NO INSTALADO  \"  "
fi
            fi


if ! $installed | grep "Entorno de escritorio LXDE" > /dev/null; then
if [ -x /usr/share/doc/lxde-common* ]; then
                    im=$im"FALSE \"Entorno de escritorio LXDE\"    \"LXDE es un entorno de escritorio de código abierto y la solución de escritorio en ahorro de energía y velocidad extrema.\" \"INSTALADO  \"  "
else
im=$im"FALSE \"Entorno de escritorio LXDE\"    \"LXDE es un entorno de escritorio de código abierto y la solución de escritorio en ahorro de energía y velocidad extrema.\" \"NO INSTALADO  \"  "
fi
            fi


if ! $installed | grep "Entorno de escritorio MATE" > /dev/null; then
if [ -x /usr/share/doc/mate-desktop* ]; then
                    im=$im"FALSE \"Entorno de escritorio MATE\"    \"MATE es un ambiente de escritorio derivado del código base, actualmente descontinuado, de GNOME 2.\" \"INSTALADO  \"  "
else
im=$im"FALSE \"Entorno de escritorio MATE\"    \"MATE es un ambiente de escritorio derivado del código base, actualmente descontinuado, de GNOME 2.\" \"NO INSTALADO  \"  "
fi
            fi


if ! $installed | grep "Desactivacion o Activacion de SELinux" > /dev/null; then

enable="SELINUX=enforcing"
disable="SELINUX=disabled"
seconfig=$(sed -n '7p' /etc/selinux/config); echo "seconfig = $seconfig"
if [ $seconfig = $enable ]; then
                    im=$im"FALSE \"Desactivacion o Activacion de SELinux\"    \"Desactiva o Activa SELinux, una característica de seguridad de Linux que provee una variedad de políticas de seguridad, incluyendo controles de acceso \" \"SELINUX ACTIVADO  \"  "

elif [ $seconfig = $disable ]; 
then
im=$im"FALSE \"Desactivacion o Activacion de SELinux\"    \"Desactiva o Activa SELinux, una característica de seguridad de Linux que provee una variedad de políticas de seguridad, incluyendo controles de acceso \" \"SELINUX NO ACTIVADO  \"  "
fi

            fi

if ! $installed | grep "Frozen Kernel" > /dev/null; then

enable="exclude=kernel*"; echo "enable = $enable"
krozker=$(grep "exclude=kernel*" /etc/yum.conf); echo "krozker = $krozker"
disable=""
if [[ $krozker = $enable ]]; then 
                    im=$im"FALSE \"Frozen Kernel\"    \"Desactiva o Activa las actualizaciones del kernel \" \"KERNEL CONGELADO  \"  "

elif [[ $krozker = $disable ]]; then
im=$im"FALSE \"Frozen Kernel\"    \"Desactiva o Activa las actualizaciones del kernel \" \"KERNEL NO CONGELADO  \"  "

fi

            fi


if ! $installed | grep "Grub Customizer" > /dev/null; then
if [ -f /usr/bin/grub-customizer ]; then
                    im=$im"FALSE \"Grub Customizer\"    \"Es una interfaz gráfica para configurar grub2/burg, sin perder el comportamiento dinámico.\" \"INSTALADO  \"  "
else
im=$im"FALSE \"Grub Customizer\"    \"Es una interfaz gráfica para configurar grub2/burg, sin perder el comportamiento dinámico.\" \"NO INSTALADO  \"  "
fi
            fi


if ! $installed | grep "Ver errores del sistema" > /dev/null; then
                    im=$im"FALSE \"Ver errores del sistema\"    \"Muestra el contenido del archivo de registro especificado y marcarcando algunas cadenas especiales \" \"ACTIVO  \"  "
            fi


if ! $installed | grep "Activar/Desactivar Repositorios" > /dev/null; then
                    im=$im"FALSE \"Activar/Desactivar Repositorios\"    \"Activa o desactiva repositorios marcar un repo para activar, desmarcar para disactivar \" \"ACTIVO  \"  "
            fi

if ! $installed | grep "Instalar Nvidia drivers" > /dev/null; then
PKGSINSTALLED=$(rpm -qa *kmod-nvidia*)
	if [[ -n "$PKGSINSTALLED" ]]; then
im=$im"FALSE \"Instalar Nvidia drivers\"    \"Instalar Nvidia drivers facilmente [Experimental] \" \"INSTALADO  \"  "
else
                    im=$im"FALSE \"Instalar Nvidia drivers\"    \"Instalar Nvidia drivers facilmente [Experimental] \" \"NO INSTALADO  \"  "
            fi
fi


if ! $installed | grep "ACTUALIZAR SISTEMA" > /dev/null; then
                    im=$im"FALSE \"ACTUALIZAR SISTEMA\"    \"Actualiza el sistema completamente [Corrige algunos errores de actualización]\" \"ACTIVO  \"  "
            fi


else
  echo 'english default'


if ! $installed | grep "Enable sudo" > /dev/null; then

SER=$(grep "$user ALL=(ALL) ALL" /etc/sudoers) > /dev/null
	if [[ "$?" != 0 ]]; then

                    im=$im"FALSE \"Enable sudo\"    \"Allows a system administrator to delegate authority to give certain users (or groups of users) the ability to run some (or all) commands as root or another user\" \"[$user] NO ADDED  \"  "
else
                    im=$im"FALSE \"Enable sudo\"    \"Allows a system administrator to delegate authority to give certain users (or groups of users) the ability to run some (or all) commands as root or another user\" \"[$user] ADDED  \"  "
fi
            fi


if ! $installed | grep "Grace period sudo" > /dev/null; then

enablesu="Defaults:ALL timestamp_timeout=0"
krozker=$(grep "Defaults:ALL timestamp_timeout=0" /etc/sudoers); echo "krozker = $krozker"
disablesu=""

if [ "$krozker" = "$enablesu" ]; then 
im=$im"FALSE \"Grace period sudo\"    \"Credentials to allow/disallow the user to run sudo again for a period of time without authentication.\" \"NO ACTIVATED  \"  "
elif [ "$krozker" = "$disablesu" ]; then
im=$im"FALSE \"Grace period sudo\"    \"Credentials to allow/disallow the user to run sudo again for a period of time without authentication..\" \"ACTIVATED  \"  "
fi
 fi


if ! $installed | grep "Remove old kernels" > /dev/null; then

if [ -f /usr/bin/yum ]; then

                    im=$im"FALSE \"Remove old kernels\"    \"Clean obsolete kernels\" \"ACTIVATED  \"  "
else
                    im=$im"FALSE \"Remove old kernels\"    \"Clean obsolete kernels\" \"NO ACTIVATED  \"  "
fi
            fi



if ! $installed | grep "Complete uncompleted installations" > /dev/null; then

if [ -f /usr/bin/yum ]; then

                    im=$im"FALSE \"Complete uncompleted installations\"    \"Complete uncompleted installations, for system errors\" \"ACTIVED  \"  "
else
im=$im"FALSE \"Complete uncompleted installations\"    \"Complete uncompleted installations, for system errors\" \"NO ACTIVATED  \"  "
fi

            fi


if ! $installed | grep "System information" > /dev/null; then
                    im=$im"FALSE \"System information\"    \"Displays system information\" \"ACTIVATED  \"  "

            fi


if ! $installed | grep "Cinnamon" > /dev/null; then
if [ -f /usr/bin/cinnamon ]; then
                    im=$im"FALSE \"Cinnamon\"    \"Cinnamon is a fork of GNOME Shell, initially developed by Linux Mint.\" \"INSTALLED  \"  "
else
im=$im"FALSE \"Cinnamon\"    \"Cinnamon is a fork of GNOME Shell, initially developed by Linux Mint.\" \"NO INSTALLED  \"  "
fi

            fi

if ! $installed | grep "Plasma-wallpaper-dreamdesktop" > /dev/null; then
if [ -f /usr/lib/kde4/dreamdesktop.so ]; then
                    im=$im"FALSE \"Plasma-wallpaper-dreamdesktop\"    \"An innovative animated desktop wallpaper for KDE.\" \"INSTALLED  \"  "
else
im=$im"FALSE \"Plasma-wallpaper-dreamdesktop\"    \"An innovative animated desktop wallpaper for KDE.\" \"NO INSTALLED  \"  "
fi

            fi


if ! $installed | grep "Desktop environment GNOME/SHELL" > /dev/null; then
if [ "`ps -e | grep gdm`" ]; then
                    im=$im"FALSE \"Desktop environment GNOME/SHELL\"    \"GNOME is a desktop environment and graphical user interface that runs on top of a computer operating system.\" \"INSTALLED  \"  "
else
im=$im"FALSE \"Desktop environment GNOME/SHELL\"    \"GNOME is a desktop environment and graphical user interface that runs on top of a computer operating system.\" \"NO INSTALLED  \"  "
fi
            fi


if ! $installed | grep "Desktop environment KDE" > /dev/null; then
if [ -x /usr/share/doc/kdesdk* ]; then
                    im=$im"FALSE \"Desktop environment KDE\"    \"KDE is a powerful graphical desktop environment for Unix workstations\" \"INSTALLED  \"  "
else
im=$im"FALSE \"Desktop environment KDE\"    \"KDE is a powerful graphical desktop environment for Unix workstations\" \"NO INSTALLED  \"  "
fi
            fi


if ! $installed | grep "Desktop environment XFCE" > /dev/null; then
if [ -x /usr/share/doc/xfce?-panel ]; then
                    im=$im"FALSE \"Desktop environment XFCE\"    \"Xfce is a lightweight desktop environment for UNIX-like operating systems.\" \"INSTALLED  \"  "
else
im=$im"FALSE \"Desktop environment XFCE\"    \"Xfce is a lightweight desktop environment for UNIX-like operating systems.\" \"NO INSTALLED  \"  "
fi
            fi


if ! $installed | grep "Desktop environment LXDE" > /dev/null; then
if [ -x /usr/share/doc/lxde-common* ]; then
                    im=$im"FALSE \"Desktop environment LXDE\"    \"LXDE is a free and open source desktop environment for Unix and other POSIX compliant platforms, such as Linux or BSD.\" \"INSTALLED  \"  "
else
im=$im"FALSE \"Desktop environment LXDE\"    \"LXDE is a free and open source desktop environment for Unix and other POSIX compliant platforms, such as Linux or BSD.\" \"NO INSTALLED  \"  "
fi
            fi


if ! $installed | grep "Desktop environment MATE" > /dev/null; then
if [ -x /usr/share/doc/mate-desktop* ]; then
                    im=$im"FALSE \"Desktop environment MATE\"    \"The MATE Desktop Environment is a fork of GNOME 2 that aims to provide an attractive and intuitive desktop to Linux.\" \"INSTALLED  \"  "
else
im=$im"FALSE \"Desktop environment MATE\"    \"The MATE Desktop Environment is a fork of GNOME 2 that aims to provide an attractive and intuitive desktop to Linux.\" \"NO INSTALLED  \"  "
fi
            fi


if ! $installed | grep "Disable or enable de SELinux" > /dev/null; then

enable="SELINUX=enforcing"
disable="SELINUX=disabled"
seconfig=$(sed -n '7p' /etc/selinux/config); echo "seconfig = $seconfig"
if [ $seconfig = $enable ]; then
                    im=$im"FALSE \"Disable or enable de SELinux\"    \"Disable o Enable SELinux,  is a Linux feature that provides the mechanism for supporting access control security policies. \" \"SELINUX ACTIVATED  \"  "

elif [ $seconfig = $disable ]; 
then
im=$im"FALSE \"Disable or enable de SELinux\"    \"Disable o Enable SELinux,  is a Linux feature that provides the mechanism for supporting access control security policies. \" \"SELINUX NO ACTIVATED  \"  "
fi

            fi

if ! $installed | grep "Frozen Kernel" > /dev/null; then

enable="exclude=kernel*"; echo "enable = $enable"
krozker=$(grep "exclude=kernel*" /etc/yum.conf); echo "krozker = $krozker"
disable=""
if [[ $krozker = $enable ]]; then 
echo 'kernel congelado'
                    im=$im"FALSE \"Frozen Kernel\"    \"Disable or Enable kernel FROZEN \" \"KERNEL CONGELADO  \"  "

elif [[ $krozker = $disable ]]; then
echo 'kernel no congelado'
im=$im"FALSE \"Frozen Kernel\"    \"Disable or Enable kernel updates \" \"KERNEL UNFROZEN  \"  "

fi
            fi


if ! $installed | grep "Grub Customizer" > /dev/null; then
if [ -f /usr/bin/grub-customizer ]; then
                    im=$im"FALSE \"Grub Customizer\"    \"Graphical interface to configure the GRUB2/BURG settings and menuentries. \" \"INSTALLED  \"  "
else
im=$im"FALSE \"Grub Customizer\"    \"Graphical interface to configure the GRUB2/BURG settings and menuentries.\" \"NO INSTALLED  \"  "
fi
            fi


if ! $installed | grep "See system errors" > /dev/null; then
                    im=$im"FALSE \"See system errors\"    \"Displays the contents of the specified log file, and mark some special strings \" \"ACTIVATED  \"  "
            fi


if ! $installed | grep "Enable/Disable Repositories" > /dev/null; then
                    im=$im"FALSE \"Enable/Disable Repositories\"    \"Enable/disable repositories, check a repo to enable, uncheck to disable \" \"ACTIVATED  \"  "
            fi

if ! $installed | grep "Install Nvidia drivers" > /dev/null; then
PKGSINSTALLED=$(rpm -qa *kmod-nvidia*)
	if [[ -n "$PKGSINSTALLED" ]]; then
im=$im"FALSE \"Install Nvidia drivers\"    \"Install Nvidia drivers easily [Experimental] \" \"INSTALLED  \"  "
else
                    im=$im"FALSE \"Install Nvidia drivers\"    \"Install Nvidia drivers easily [Experimental] \" \"NO INSTALLED  \"  "
            fi
fi


if ! $installed | grep "UPDATE SYSTEM" > /dev/null; then
                    im=$im"FALSE \"UPDATE SYSTEM\"    \"Update the system completely [It'll fix some errors]\" \"ACTIVE  \"  "
            fi


fi


    }


chooseInstalls(){
     
            #choosing witch installs/tweaks to run
            echo "Running Choice Menu..."
            choice=`echo $im | sh -`


if echo $choice | grep "Activar sudo" > /dev/null; then
                    sudouser
            fi

if echo $choice | grep "Enable sudo" > /dev/null; then
                    sudouser
            fi


if echo $choice | grep "Periodo de gracia sudo" > /dev/null; then
                    graciasudo
            fi

if echo $choice | grep "Grace period sudo" > /dev/null; then
                    graciasudo
            fi          
           
if echo $choice | grep "Eliminar Kernels Antiguos" > /dev/null; then
                    kernelold
            fi

if echo $choice | grep "Remove old kernels" > /dev/null; then
                    kernelold
            fi


if echo $choice | grep "Completar Instalaciones pendientes" > /dev/null; then
                    pendientes
            fi

if echo $choice | grep "Complete uncompleted installations" > /dev/null; then
                    pendientes
            fi


if echo $choice | grep "System information" > /dev/null; then
                    infosystem
            fi

if echo $choice | grep "Informacion del Sistema" > /dev/null; then
                    infosystem
            fi

if echo $choice | grep "Cinnamon" > /dev/null; then
                    cinnamon
            fi

if echo $choice | grep "Plasma-wallpaper-dreamdesktop" > /dev/null; then
                    dreamd
            fi

if echo $choice | grep "Jocky" > /dev/null; then
                    jocky
            fi

if echo $choice | grep "Entorno de escritorio GNOME" > /dev/null; then
                    gnodesk
            fi

if echo $choice | grep "Desktop environment GNOME/SHELL" > /dev/null; then
                    gnodesk
            fi


if echo $choice | grep "Entorno de escritorio KDE" > /dev/null; then
                    kdesk
            fi

if echo $choice | grep "Desktop environment KDE" > /dev/null; then
                    kdesk
            fi


if echo $choice | grep "Entorno de escritorio XFCE" > /dev/null; then
                    xfdesk
            fi

if echo $choice | grep "Desktop environment XFCE" > /dev/null; then
                    xfdesk
            fi


if echo $choice | grep "Entorno de escritorio LXDE" > /dev/null; then
                    lxdesk
            fi

if echo $choice | grep "Desktop environment LXDE" > /dev/null; then
                    lxdesk
            fi


if echo $choice | grep "Entorno de escritorio MATE" > /dev/null; then
                    mat
            fi

if echo $choice | grep "Desktop environment MATE" > /dev/null; then
                    mat
            fi


if echo $choice | grep "Desactivacion o Activacion de SELinux" > /dev/null; then
                    SLinux
            fi

if echo $choice | grep "Disable or enable de SELinux" > /dev/null; then
                    SLinux
            fi

if echo $choice | grep "Frozen Kernel" > /dev/null; then
                    frozen
            fi

if echo $choice | grep "Grub Customizer" > /dev/null; then
                    grubcus
            fi

if echo $choice | grep "Ver errores del sistema" > /dev/null; then
                    errors
            fi

if echo $choice | grep "See system errors" > /dev/null; then
                    errors
            fi

if echo $choice | grep "Activar/Desactivar Repositorios" > /dev/null; then
                    reposi
            fi

if echo $choice | grep "Enable/Disable Repositories" > /dev/null; then
                    reposi
            fi

if echo $choice | grep "Instalar Nvidia drivers" > /dev/null; then
                    nvidia
            fi

if echo $choice | grep "Install Nvidia drivers" > /dev/null; then
                    nvidia
            fi


if echo $choice | grep "ACTUALIZAR SISTEMA" > /dev/null; then
                    actualizar
            fi

if echo $choice | grep "UPDATE SYSTEM" > /dev/null; then
                    actualizar
            fi


    }
     
     
    ##
    ## Tweak/Install functions
    ##


sudouser(){

postinstaller -d

    }

graciasudo(){

postinstaller -b

    }


kernelold(){

postinstaller -o


    }


pendientes(){
            yum-complete-transaction | $localprogress

su $user -c 'notify-send "PostInstallerF" "Completado Instalaciones pendientes" -i "/usr/share/icons/pinguino.png" -t 5000'

    }


infosystem(){
            zenity --info --title="Informacion del Sistema" --text="Distribucion: 
$(cat /etc/fedora-release)\n\nKernel: $(uname -s -r)\n\nArchitecture: 
$(uname -i)\n\nRAM: $(cat /proc/meminfo | grep MemTotal | cut -c10-)\n\nGraphics Card: 
$(/sbin/lspci | grep VGA)\n\nGraphics Drivers: 
$(glxinfo | grep renderer)\n\nSound Card: 
$(lspci | grep -i audio)\n\nNetwork: 
$(lspci | grep -i network)\n\nUptime: 
$(uptime)" --ok-label="Ok"


su $user -c 'notify-send "PostInstallerF" "Completado informacion del sistema" -i "/usr/share/icons/sistema.png" -t 5000'


    }



cinnamon(){

postinstaller -i cinnamon


if [ -f /usr/bin/cinnamon ]; then

su $user -c 'notify-send "PostInstallerF" "Completada la instalacion de Cinnamon" -i "/usr/share/icons/sistema.png" -t 5000'
else 
zenity --info --title="PostInstallerF" --text="Por alguna razon Cinnamon no esta instalado, vuelva a intentar "
fi


    }


dreamd(){

postinstaller -i plasma-wallpaper-dreamdesktop 

if [ -f /usr/lib/kde4/dreamdesktop.so ]; then


su $user -c 'notify-send "PostInstallerF" "Completada la instalacion de Plasma-wallpaper-dreamdesktop" -i "/usr/share/icons/sistema.png" -t 5000'
else 
zenity --info --title="PostInstallerF" --text="Por alguna razon Plasma-wallpaper-dreamdesktop no esta instalado, vuelva a intentar "
fi

    }


gnodesk(){
            $especific @gnome-desktop | $localprogress


su $user -c 'notify-send "PostInstallerF" "Completada la instalacion Entorno de escritorio GNOME/SHELL" -i "/usr/share/icons/sistema.png" -t 5000'


    }


kdesk(){
            $especific @kde-desktop | $localprogress


su $user -c 'notify-send "PostInstallerF" "Completada la instalacion Entorno de escritorio KDE" -i "/usr/share/icons/sistema.png" -t 5000'


    }


xfdesk(){
            $especific @xfce-desktop | $localprogress

$postlist greybird-gtk2-theme greybird-gtk2-theme greybird-xfwm4-theme greybird-xfce4-notifyd-theme xfce4-volumed | $progress


su $user -c 'notify-send "PostInstallerF" "Completada la instalacion de Entorno de escritorio XFCE" -i "/usr/share/icons/sistema.png" -t 5000'


    }


lxdesk(){
            $especific @lxde-desktop | $localprogress

su $user -c 'notify-send "PostInstallerF" "Completada la instalacion de Entorno de escritorio LXDE" -i "/usr/share/icons/sistema.png" -t 5000'


    }

mat(){

yum -y groupinstall mate-desktop | $localprogress

$postlist mate-media | $progress


su $user -c 'notify-send "PostInstallerF" "Completada la instalacion de Entorno de escritorio MATE" -i "/usr/share/icons/sistema.png" -t 5000'


    }


SLinux(){
            
postinstaller -a

    }


frozen(){
            
postinstaller -f

    }

grubcus(){
            
postinstaller -i grub-customizer


if [ -f /usr/bin/grub-customizer ]; then

su $user -c 'notify-send "PostInstallerF" "Completada la instalacion de Grub Customizer" -i "/usr/share/icons/sistema.png" -t 5000'
else 
zenity --info --title="PostInstallerF" --text="Por alguna razon Grub Customizer no esta instalado, vuelva a intentar "
fi


    }

errors(){
LOGFILE=${1:-/var/log/messages}

PARSER='{font=""; color="#FFFFFF"}; \
/kernel/ {font="italic"}; \
/warn/ {color="#FFF4B8"}; \
/error/ {color="#FFD0D8"}; \
OFS="\n" {print $1 " " $2, $3, $4, substr($5,0,index($5,":")-1), \
substr($0,index($0,$6)), font, color; fflush()}'

tail -f $LOGFILE | awk "$PARSER" | \
yad --title="Log viewer" --window-icon=logviewer \
    --button=gtk-close --geometry 600x350 \
    --list --text="Content of $LOGFILE" \
    --column Date --column Time --column Host \
    --column Tag --column Message:TIP \
    --column @font@ --column @back@

exit $?
su $user -c 'notify-send "PostInstallerF" "Acabas de ver los errores del sistema" -i "/usr/share/icons/sistema.png" -t 5000'

}


reposi(){

gpk-prefs

su $user -c 'notify-send "PostInstallerF" "Recuerde los cambios hechos en los repositorios" -i "/usr/share/icons/sistema.png" -t 5000'

}


nvidia(){

/usr/bin/postinstallerf/tweek/nvidia

}


actualizar(){

if [ $(rpm -q --queryformat '%{VERSION}\n' fedora-release) = "20" ]; then

setenforce 0
xterm -e 'yum -y clean expire-cache'
xterm -e 'yum -y update selinux-policy\*'
xterm -e 'rm -f /var/lib/rpm/_db*'

xterm -e 'rpm -vv --rebuilddb' 

yum-complete-transaction --cleanup-only -y | $localprogress

yum clean all 

postinstaller -u

setenforce 1


else

xterm -e 'rm -f /var/lib/rpm/_db*'

xterm -e 'rpm -vv --rebuilddb' 

yum-complete-transaction --cleanup-only -y | $localprogress

yum clean all 

postinstaller -u
fi

su $user -c 'notify-send "PostInstallerF" "Se ha actualizado el sistema" -i "/usr/share/icons/sistema.png" -t 5000'

    }
    
     
    ##
    ## Initialising PostInstallerF
    ##

     
    #initialising pkcon install-list
    postlist='pkcon -p -y install'

    # Local install
    locainst='yum -y localinstall'

    # Especific rpm
    especific='yum -y install'
   
    # Define Architecture
    architecture=$(uname -m)

    # Define version Fedora
    version=$(rpm -q --queryformat '%{VERSION}\n' fedora-release)

    # Progress
    progress='/usr/bin/postinstallerf/progress'

    # Local Progress
    localprogress='/usr/bin/postinstallerf/local-pro'
     
    #initialising post-yum job list
    postYum=""
     
    #initialising post-yum job list
    postRoot="exit; "
     
    #initialising notification
    user=$(loginctl show-session $XDG_SESSION_ID | grep 'Name' | cut -d= -f2 | tail -n 1)


# running PostInstallerF...
    generateInstallMenu
    chooseInstalls
     
    
     
     
    #runing yum and post-yum commands
    if test ${#yumList} -gt 15; then
            echo "Installing selected packages [yum]..."
            echo $yumList | sh -
            #| zenity --progress --pulsate --auto-close --text "Installing selected packages..."
    fi
    if test ${#postYum} -gt 0; then
            echo "Runing post install scripts..."
            echo $postYum | sh -
    fi
    if test ${#postRoot} -gt 6; then
            echo "Runing post root scripts..."
            echo $postRoot | sh -
    fi
     
    #if there was something to do
    if test ${#choice} -gt 0; then
       echo 'todo terminado'
       cleanlist	 
            
    fi

     
    exit 0
